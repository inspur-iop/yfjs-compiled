define("echarts2/chart/heatmap",["require","./base","../layer/heatmap","../config","../util/ecData","zrender2/tool/util","zrender2/tool/color","zrender2/shape/Image","../chart"],function(a){function b(a,b,d,e,f){c.call(this,a,b,d,e,f),this.refresh(e)}var c=a("./base"),d=a("../layer/heatmap"),e=a("../config"),f=(a("../util/ecData"),a("zrender2/tool/util")),g=(a("zrender2/tool/color"),a("zrender2/shape/Image"));return e.heatmap={zlevel:0,z:2,clickable:!0},b.prototype={type:e.CHART_TYPE_HEATMAP,refresh:function(a){this.clear(),a&&(this.option=a,this.series=a.series),this._init()},_init:function(){var a=this.series;this.backupShapeList();for(var b=a.length,c=0;c<b;++c)if(a[c].type===e.CHART_TYPE_HEATMAP){a[c]=this.reformOption(a[c]);var f=new d(a[c]),h=f.getCanvas(a[c].data,this.zr.getWidth(),this.zr.getHeight()),i=new g({position:[0,0],scale:[1,1],hoverable:this.option.hoverable,style:{x:0,y:0,image:h,width:h.width,height:h.height}});this.shapeList.push(i)}this.addShapeList()}},f.inherits(b,c),a("../chart").define("heatmap",b),b}),define("echarts2/layer/heatmap",["require"],function(a){function b(a){if(this.option=a,a)for(var b in c)void 0!==a[b]?this.option[b]=a[b]:this.option[b]=c[b];else this.option=c}var c={blurSize:30,gradientColors:["blue","cyan","lime","yellow","red"],minAlpha:.05,valueScale:1,opacity:1},d=20,e=256;return b.prototype={getCanvas:function(a,b,c){var f=this._getBrush(),g=this._getGradient(),h=d+this.option.blurSize,i=document.createElement("canvas");i.width=b,i.height=c;for(var j=i.getContext("2d"),k=a.length,l=0;l<k;++l){var m=a[l],n=m[0],o=m[1],p=m[2],q=Math.min(1,Math.max(p*this.option.valueScale||this.option.minAlpha,this.option.minAlpha));j.globalAlpha=q,j.drawImage(f,n-h,o-h)}for(var r=j.getImageData(0,0,i.width,i.height),s=r.data,k=s.length/4;k--;){var t=4*k+3,q=s[t]/256,u=Math.floor(q*(e-1));s[t-3]=g[4*u],s[t-2]=g[4*u+1],s[t-1]=g[4*u+2],s[t]*=this.option.opacity}return j.putImageData(r,0,0),i},_getBrush:function(){if(!this._brushCanvas){this._brushCanvas=document.createElement("canvas");var a=d+this.option.blurSize,b=2*a;this._brushCanvas.width=b,this._brushCanvas.height=b;var c=this._brushCanvas.getContext("2d");c.shadowOffsetX=b,c.shadowBlur=this.option.blurSize,c.shadowColor="black",c.beginPath(),c.arc(-a,a,d,0,2*Math.PI,!0),c.closePath(),c.fill()}return this._brushCanvas},_getGradient:function(){if(!this._gradientPixels){var a=e,b=document.createElement("canvas");b.width=1,b.height=a;for(var c=b.getContext("2d"),d=c.createLinearGradient(0,0,0,a),f=this.option.gradientColors.length,g=0;g<f;++g)"string"==typeof this.option.gradientColors[g]?d.addColorStop((g+1)/f,this.option.gradientColors[g]):d.addColorStop(this.option.gradientColors[g].offset,this.option.gradientColors[g].color);c.fillStyle=d,c.fillRect(0,0,1,a),this._gradientPixels=c.getImageData(0,0,1,a).data}return this._gradientPixels}},b});