define("echarts2/chart/scatter",["require","./base","../util/shape/Symbol","../component/axis","../component/grid","../component/dataZoom","../component/dataRange","../config","zrender2/tool/util","zrender2/tool/color","../chart"],function(a){function b(a,b,d,e,f){c.call(this,a,b,d,e,f),this.refresh(e)}var c=a("./base"),d=a("../util/shape/Symbol");a("../component/axis"),a("../component/grid"),a("../component/dataZoom"),a("../component/dataRange");var e=a("../config");e.scatter={zlevel:0,z:2,clickable:!0,legendHoverLink:!0,xAxisIndex:0,yAxisIndex:0,symbolSize:4,large:!1,largeThreshold:2e3,itemStyle:{normal:{label:{show:!1}},emphasis:{label:{show:!1}}}};var f=a("zrender2/tool/util"),g=a("zrender2/tool/color");return b.prototype={type:e.CHART_TYPE_SCATTER,_buildShape:function(){var a=this.series;this._sIndex2ColorMap={},this._symbol=this.option.symbolList,this._sIndex2ShapeMap={},this.selectedMap={},this.xMarkMap={};for(var b,c,d,f,h=this.component.legend,i=[],j=0,k=a.length;j<k;j++)if(b=a[j],c=b.name,b.type===e.CHART_TYPE_SCATTER){if(a[j]=this.reformOption(a[j]),this.legendHoverLink=a[j].legendHoverLink||this.legendHoverLink,this._sIndex2ShapeMap[j]=this.query(b,"symbol")||this._symbol[j%this._symbol.length],h){if(this.selectedMap[c]=h.isSelected(c),this._sIndex2ColorMap[j]=g.alpha(h.getColor(c),.5),d=h.getItemShape(c)){var f=this._sIndex2ShapeMap[j];d.style.brushType=f.match("empty")?"stroke":"both",f=f.replace("empty","").toLowerCase(),f.match("rectangle")&&(d.style.x+=Math.round((d.style.width-d.style.height)/2),d.style.width=d.style.height),f.match("star")&&(d.style.n=f.replace("star","")-0||5,f="star"),f.match("image")&&(d.style.image=f.replace(new RegExp("^image:\\/\\/"),""),d.style.x+=Math.round((d.style.width-d.style.height)/2),d.style.width=d.style.height,f="image"),d.style.iconType=f,h.setItemShape(c,d)}}else this.selectedMap[c]=!0,this._sIndex2ColorMap[j]=g.alpha(this.zr.getColor(j),.5);this.selectedMap[c]&&i.push(j)}this._buildSeries(i),this.addShapeList()},_buildSeries:function(a){if(0!==a.length){for(var b,c,d,e,f,g,h,i,j=this.series,k={},l=0,m=a.length;l<m;l++)if(b=a[l],c=j[b],0!==c.data.length){f=this.component.xAxis.getAxis(c.xAxisIndex||0),g=this.component.yAxis.getAxis(c.yAxisIndex||0),k[b]=[];for(var n=0,o=c.data.length;n<o;n++)d=c.data[n],"-"===(e=this.getDataFromOption(d,"-"))||e.length<2||(h=f.getCoord(e[0]),i=g.getCoord(e[1]),k[b].push([h,i,n,d.name||""]));this.xMarkMap[b]=this._markMap(f,g,c.data,k[b]),this.buildMark(b)}this._buildPointList(k)}},_markMap:function(a,b,c,d){for(var e,f={min0:Number.POSITIVE_INFINITY,max0:Number.NEGATIVE_INFINITY,sum0:0,counter0:0,average0:0,min1:Number.POSITIVE_INFINITY,max1:Number.NEGATIVE_INFINITY,sum1:0,counter1:0,average1:0},g=0,h=d.length;g<h;g++)e=c[d[g][2]].value||c[d[g][2]],f.min0>e[0]&&(f.min0=e[0],f.minY0=d[g][1],f.minX0=d[g][0]),f.max0<e[0]&&(f.max0=e[0],f.maxY0=d[g][1],f.maxX0=d[g][0]),f.sum0+=e[0],f.counter0++,f.min1>e[1]&&(f.min1=e[1],f.minY1=d[g][1],f.minX1=d[g][0]),f.max1<e[1]&&(f.max1=e[1],f.maxY1=d[g][1],f.maxX1=d[g][0]),f.sum1+=e[1],f.counter1++;var i=this.component.grid.getX(),j=this.component.grid.getXend(),k=this.component.grid.getY(),l=this.component.grid.getYend();f.average0=f.sum0/f.counter0;var m=a.getCoord(f.average0);f.averageLine0=[[m,l],[m,k]],f.minLine0=[[f.minX0,l],[f.minX0,k]],f.maxLine0=[[f.maxX0,l],[f.maxX0,k]],f.average1=f.sum1/f.counter1;var n=b.getCoord(f.average1);return f.averageLine1=[[i,n],[j,n]],f.minLine1=[[i,f.minY1],[j,f.minY1]],f.maxLine1=[[i,f.maxY1],[j,f.maxY1]],f},_buildPointList:function(a){var b,c,d,e,f=this.series;for(var g in a)if(b=f[g],c=a[g],b.large&&b.data.length>b.largeThreshold)this.shapeList.push(this._getLargeSymbol(b,c,this.getItemStyleColor(this.query(b,"itemStyle.normal.color"),g,-1)||this._sIndex2ColorMap[g]));else for(var h=0,i=c.length;h<i;h++)d=c[h],(e=this._getSymbol(g,d[2],d[3],d[0],d[1]))&&this.shapeList.push(e)},_getSymbol:function(a,b,c,d,e){var f,g=this.series,h=g[a],i=h.data[b],j=this.component.dataRange;if(j){if(!(f=isNaN(i[2])?this._sIndex2ColorMap[a]:j.getColor(i[2])))return null}else f=this._sIndex2ColorMap[a];var k=this.getSymbolShape(h,a,i,b,c,d,e,this._sIndex2ShapeMap[a],f,"rgba(0,0,0,0)","vertical");return k.zlevel=h.zlevel,k.z=h.z,k._main=!0,k},_getLargeSymbol:function(a,b,c){return new d({zlevel:a.zlevel,z:a.z,_main:!0,hoverable:!1,style:{pointList:b,color:c,strokeColor:c},highlightStyle:{pointList:[]}})},getMarkCoord:function(a,b){var c,d=this.series[a],e=this.xMarkMap[a],f=this.component.xAxis.getAxis(d.xAxisIndex),g=this.component.yAxis.getAxis(d.yAxisIndex);if(!b.type||"max"!==b.type&&"min"!==b.type&&"average"!==b.type)c=["string"!=typeof b.xAxis&&f.getCoordByIndex?f.getCoordByIndex(b.xAxis||0):f.getCoord(b.xAxis||0),"string"!=typeof b.yAxis&&g.getCoordByIndex?g.getCoordByIndex(b.yAxis||0):g.getCoord(b.yAxis||0)];else{var h=null!=b.valueIndex?b.valueIndex:1;c=[e[b.type+"X"+h],e[b.type+"Y"+h],e[b.type+"Line"+h],e[b.type+h]]}return c},refresh:function(a){a&&(this.option=a,this.series=a.series),this.backupShapeList(),this._buildShape()},ondataRange:function(a,b){this.component.dataRange&&(this.refresh(),b.needRefresh=!0)}},f.inherits(b,c),a("../chart").define("scatter",b),b});