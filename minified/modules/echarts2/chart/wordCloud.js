define("echarts2/chart/wordCloud",["require","./base","zrender2/shape/Text","../layout/WordCloud","../component/grid","../component/dataRange","../config","../util/ecData","zrender2/tool/util","zrender2/tool/color","../chart"],function(a){function b(a,b,d,e,f){c.call(this,a,b,d,e,f),this.refresh(e)}var c=a("./base"),d=a("zrender2/shape/Text"),e=a("../layout/WordCloud");a("../component/grid"),a("../component/dataRange");var f=a("../config"),g=a("../util/ecData"),h=a("zrender2/tool/util"),i=a("zrender2/tool/color");return f.wordCloud={zlevel:0,z:2,clickable:!0,center:["50%","50%"],size:["40%","40%"],textRotation:[0,90],textPadding:0,autoSize:{enable:!0,minSize:12},itemStyle:{normal:{textStyle:{fontSize:function(a){return a.value}}}}},b.prototype={type:f.CHART_TYPE_WORDCLOUD,refresh:function(a){a&&(this.option=a,this.series=a.series),this._init()},_init:function(){var a=this.series;this.backupShapeList();for(var b=this.component.legend,c=0;c<a.length;c++)if(a[c].type===f.CHART_TYPE_WORDCLOUD){a[c]=this.reformOption(a[c]);var d=a[c].name||"";if(this.selectedMap[d]=!b||b.isSelected(d),!this.selectedMap[d])continue;this.buildMark(c),this._initSerie(a[c])}},_initSerie:function(a){var b=a.itemStyle.normal.textStyle,c=[this.parsePercent(a.size[0],this.zr.getWidth())||200,this.parsePercent(a.size[1],this.zr.getHeight())||200],d=this.parseCenter(this.zr,a.center),f={size:c,wordletype:{autoSizeCal:a.autoSize},center:d,rotate:a.textRotation,padding:a.textPadding,font:b.fontFamily,fontSize:b.fontSize,fontWeight:b.fontWeight,fontStyle:b.fontStyle,text:function(a){return a.name},data:a.data},g=new e(f),h=this;g.end(function(a){h._buildShapes(a)}),g.start()},_buildShapes:function(a){for(var b=a.length,c=0;c<b;c++)this._buildTextShape(a[c],0,c);this.addShapeList()},_buildTextShape:function(a,b,c){var e=this.series,f=e[b],h=f.name||"",j=f.data[c],k=[j,f],l=this.component.legend,m=l?l.getColor(h):this.zr.getColor(b),n=this.deepMerge(k,"itemStyle.normal")||{},o=this.deepMerge(k,"itemStyle.emphasis")||{},p=this.getItemStyleColor(n.color,b,c,j)||m,q=this.getItemStyleColor(o.color,b,c,j)||("string"==typeof p?i.lift(p,-.2):p),r=new d({zlevel:f.zlevel,z:f.z,hoverable:!0,clickable:this.deepQuery(k,"clickable"),style:{x:0,y:0,text:a.text,color:p,textFont:[a.style,a.weight,a.size+"px",a.font].join(" "),textBaseline:"alphabetic",textAlign:"center"},highlightStyle:{brushType:o.borderWidth?"both":"fill",color:q,lineWidth:o.borderWidth||0,strokeColor:o.borderColor},position:[a.x,a.y],rotation:[-a.rotate/180*Math.PI,0,0]});g.pack(r,f,b,j,c,j.name),this.shapeList.push(r)}},h.inherits(b,c),a("../chart").define("wordCloud",b),b}),define("echarts2/layout/WordCloud",["require","../layout/WordCloudRectZero","zrender2/tool/util"],function(a){function b(a){this._init(a)}var c=a("../layout/WordCloudRectZero"),d=a("zrender2/tool/util");return b.prototype={start:function(){function a(){o.totalArea=g,m.autoSizeCal.enable&&o._autoCalTextSize(k,g,e,f,m.autoSizeCal.minSize),l.timer&&clearInterval(l.timer),l.timer=setInterval(b,0),b()}function b(){for(var a,b=+new Date,c=k.length;+new Date-b<l.timeInterval&&++h<c&&l.timer;)a=k[h],a.x=n[0]>>1,a.y=n[1]>>1,o._cloudSprite(a,k,h),a.hasText&&o._place(d,a,j)&&(i.push(a),a.x-=n[0]>>1,a.y-=n[1]>>1);h>=c&&(o.stop(),o._fixTagPosition(i),l.endcallback(i))}var d=null,e=0,f=0,g=0,h=-1,i=[],j=null,k=this.wordsdata,l=this.defaultOption,m=l.wordletype,n=l.size,o=this;return new c({type:m.type,width:n[0],height:n[1]}).calculate(function(b){d=b.initarr,e=b.maxWit,f=b.maxHit,g=b.area,j=b.imgboard,a()},this),this},_fixTagPosition:function(a){for(var b=this.defaultOption.center,c=0,d=a.length;c<d;c++)a[c].x+=b[0],a[c].y+=b[1]},stop:function(){return this.defaultOption.timer&&(clearInterval(this.defaultOption.timer),this.defaultOption.timer=null),this},end:function(a){return a&&(this.defaultOption.endcallback=a),this},_init:function(a){this.defaultOption={},this._initProperty(a),this._initMethod(a),this._initCanvas(),this._initData(a.data)},_initData:function(a){var b=this,c=b.defaultOption;this.wordsdata=a.map(function(a,d){return a.text=c.text.call(b,a,d),a.font=c.font.call(b,a,d),a.style=c.fontStyle.call(b,a,d),a.weight=c.fontWeight.call(b,a,d),a.rotate=c.rotate.call(b,a,d),a.size=~~c.fontSize.call(b,a,d),a.padding=c.padding.call(b,a,d),a}).sort(function(a,b){return b.value-a.value})},_initMethod:function(a){function b(a){return a.name}function c(){return"sans-serif"}function d(){return"normal"}function e(a){return a.value}function f(){return 0}function g(a){return function(){return a[Math.round(Math.random()*(a.length-1))]}}function h(){return 0}function i(a){var b=a[0]/a[1];return function(a){return[b*(a*=.1)*Math.cos(a),a*Math.sin(a)]}}function j(a){var b=4,c=b*a[0]/a[1],d=0,e=0;return function(a){var f=a<0?-1:1;switch(Math.sqrt(1+4*f*a)-f&3){case 0:d+=c;break;case 1:e+=b;break;case 2:d-=c;break;default:e-=b}return[d,e]}}function k(a){return"function"==typeof a?a:function(){return a}}var l=this.defaultOption;l.text=a.text?k(a.text):b,l.font=a.font?k(a.font):c,l.fontSize=a.fontSize?k(a.fontSize):e,l.fontStyle=a.fontStyle?k(a.fontStyle):d,l.fontWeight=a.fontWeight?k(a.fontWeight):d,l.rotate=a.rotate?g(a.rotate):f,l.padding=a.padding?k(a.padding):h,l.center=a.center,l.spiral=i,l.endcallback=function(){},l.rectangularSpiral=j,l.archimedeanSpiral=i},_initProperty:function(a){var b=this.defaultOption;b.size=a.size||[256,256],b.wordletype=a.wordletype,b.words=a.words||[],b.timeInterval=1/0,b.timer=null,b.spirals={archimedean:b.archimedeanSpiral,rectangular:b.rectangularSpiral},d.merge(b,{size:[256,256],wordletype:{type:"RECT",areaPresent:.058,autoSizeCal:{enable:!0,minSize:12}}})},_initCanvas:function(){var a,b=Math.PI/180,c=64,d=2048,e=1;"undefined"!=typeof document?(a=document.createElement("canvas"),a.width=1,a.height=1,e=Math.sqrt(a.getContext("2d").getImageData(0,0,1,1).data.length>>2),a.width=(c<<5)/e,a.height=d/e):a=new Canvas(c<<5,d);var f=a.getContext("2d");f.fillStyle=f.strokeStyle="red",f.textAlign="center",this.defaultOption.c=f,this.defaultOption.cw=c,this.defaultOption.ch=d,this.defaultOption.ratio=e,this.defaultOption.cloudRadians=b},_cloudSprite:function(a,b,c){if(!a.sprite){var d=this.defaultOption.cw,e=this.defaultOption.ch,f=this.defaultOption.c,g=this.defaultOption.ratio,h=this.defaultOption.cloudRadians;f.clearRect(0,0,(d<<5)/g,e/g);var i=0,j=0,k=0,l=b.length;for(--c;++c<l;){a=b[c],f.save(),f.font=a.style+" "+a.weight+" "+~~((a.size+1)/g)+"px "+a.font;var m=f.measureText(a.text+"m").width*g,n=a.size<<1;if(a.rotate){var o=Math.sin(a.rotate*h),p=Math.cos(a.rotate*h),q=m*p,r=m*o,s=n*p,t=n*o;m=Math.max(Math.abs(q+t),Math.abs(q-t))+31>>5<<5,n=~~Math.max(Math.abs(r+s),Math.abs(r-s))}else m=m+31>>5<<5;if(n>k&&(k=n),i+m>=d<<5&&(i=0,j+=k,k=0),j+n>=e)break;f.translate((i+(m>>1))/g,(j+(n>>1))/g),a.rotate&&f.rotate(a.rotate*h),f.fillText(a.text,0,0),a.padding&&(f.lineWidth=2*a.padding,f.strokeText(a.text,0,0)),f.restore(),a.width=m,a.height=n,a.xoff=i,a.yoff=j,a.x1=m>>1,a.y1=n>>1,a.x0=-a.x1,a.y0=-a.y1,a.hasText=!0,i+=m}for(var u=f.getImageData(0,0,(d<<5)/g,e/g).data,v=[];--c>=0;)if(a=b[c],a.hasText){for(var m=a.width,w=m>>5,n=a.y1-a.y0,x=0;x<n*w;x++)v[x]=0;if(null==(i=a.xoff))return;j=a.yoff;for(var y=0,z=-1,A=0;A<n;A++){for(var x=0;x<m;x++){var B=w*A+(x>>5),C=u[(j+A)*(d<<5)+(i+x)<<2]?1<<31-x%32:0;v[B]|=C,y|=C}y?z=A:(a.y0++,n--,A--,j++)}a.y1=a.y0+z,a.sprite=v.slice(0,(a.y1-a.y0)*w)}}},_place:function(a,b,c){function d(a,b,c){c>>=5;for(var d,e=a.sprite,f=a.width>>5,g=a.x-(f<<4),h=127&g,i=32-h,j=a.y1-a.y0,k=(a.y+a.y0)*c+(g>>5),l=0;l<j;l++){d=0;for(var m=0;m<=f;m++)if((d<<i|(m<f?(d=e[l*f+m])>>>h:0))&b[k+m])return!0;k+=c}return!1}function e(a,b){return b.row[a.y]&&b.cloumn[a.x]&&a.x>=b.row[a.y].start&&a.x<=b.row[a.y].end&&a.y>=b.cloumn[a.x].start&&a.y<=b.cloumn[a.x].end}for(var f,g,h,i=this.defaultOption.size,j=(i[0],i[1],b.x),k=b.y,l=Math.sqrt(i[0]*i[0]+i[1]*i[1]),m=this.defaultOption.spiral(i),n=Math.random()<.5?1:-1,o=-n;(f=m(o+=n))&&(g=~~f[0],h=~~f[1],!(Math.min(g,h)>l));)if(b.x=j+g,b.y=k+h,!(b.x+b.x0<0||b.y+b.y0<0||b.x+b.x1>i[0]||b.y+b.y1>i[1])&&!d(b,a,i[0])&&e(b,c)){for(var p,q=b.sprite,r=b.width>>5,s=i[0]>>5,t=b.x-(r<<4),u=127&t,v=32-u,w=b.y1-b.y0,x=(b.y+b.y0)*s+(t>>5),y=0;y<w;y++){p=0;for(var z=0;z<=r;z++)a[x+z]|=p<<v|(z<r?(p=q[y*r+z])>>>u:0);x+=s}return delete b.sprite,!0}return!1},_autoCalTextSize:function(a,b,c,d,e){function f(a){p.clearRect(0,0,(n<<5)/q,o/q),p.save(),p.font=a.style+" "+a.weight+" "+~~((a.size+1)/q)+"px "+a.font;var b=p.measureText(a.text+"m").width*q,g=a.size<<1;b=b+31>>5<<5,p.restore(),a.aw=b,a.ah=g;var h,i,j;if(a.rotate){var k=Math.sin(a.rotate*r),l=Math.cos(a.rotate*r),s=b*l,t=b*k,u=g*l,v=g*k;i=Math.max(Math.abs(s+v),Math.abs(s-v))+31>>5<<5,j=~~Math.max(Math.abs(t+u),Math.abs(t-u))}return a.size<=m||a.rotate&&b*g<=a.area&&i<=c&&j<=d||b*g<=a.area&&b<=c&&g<=d?void(a.area=b*g):(h=a.rotate&&i>c&&j>d?Math.min(c/i,d/j):b>c||g>d?Math.min(c/b,d/g):Math.sqrt(a.area/(a.aw*a.ah)),a.size=~~(h*a.size),a.size<e?void(a.size=e):f(a))}function g(a,b){for(var c=a.length,d=0;c--;)d+=b(a[c]);return d}for(var h,i,j=g(a,function(a){return a.size}),k=a.length,l=.25,m=e,n=this.defaultOption.cw,o=this.defaultOption.ch,p=this.defaultOption.c,q=this.defaultOption.ratio,r=this.defaultOption.cloudRadians;k--;)h=a[k],i=h.size/j,h.areapre=l?i<l?i:l:i,h.area=b*h.areapre,h.totalarea=b,f(h)}},b}),define("echarts2/layout/WordCloudRectZero",["require"],function(a){function b(a){this.defaultOption={type:"RECT"},this._init(a)}return b.prototype={RECT:"_calculateRect",_init:function(a){this._initOption(a),this._initCanvas()},_initOption:function(a){for(k in a)this.defaultOption[k]=a[k]},_initCanvas:function(){var a=document.createElement("canvas");a.width=1,a.height=1;var b=Math.sqrt(a.getContext("2d").getImageData(0,0,1,1).data.length>>2);if(a.width=this.defaultOption.width,a.height=this.defaultOption.height,a.getContext)var c=a.getContext("2d");this.canvas=a,this.ctx=c,this.ratio=b},calculate:function(a,b){this[this[this.defaultOption.type]].call(this,a,b)},_calculateReturn:function(a,b,c){b.call(c,a)},_calculateRect:function(a,b){var c={},d=this.defaultOption.width>>5<<5,e=this.defaultOption.height;c.initarr=this._rectZeroArray(d*e),c.area=d*e,c.maxHit=e,c.maxWit=d,c.imgboard=this._rectBoard(d,e),this._calculateReturn(c,a,b)},_rectBoard:function(a,b){for(var c=[],d=0;d<b;d++)c.push({y:d,start:0,end:a});for(var e=[],d=0;d<a;d++)e.push({x:d,start:0,end:b});return{row:c,cloumn:e}},_rectZeroArray:function(a){for(var b=[],c=a,d=-1;++d<c;)b[d]=0;return b}},b});