define("echarts2/chart/venn",["require","./base","zrender2/shape/Text","zrender2/shape/Circle","zrender2/shape/Path","../config","../util/ecData","zrender2/tool/util","../chart"],function(a){function b(a,b,d,e,f){c.call(this,a,b,d,e,f),this.refresh(e)}var c=a("./base"),d=a("zrender2/shape/Text"),e=a("zrender2/shape/Circle"),f=a("zrender2/shape/Path"),g=a("../config");g.venn={zlevel:0,z:1,calculable:!1};var h=a("../util/ecData"),i=a("zrender2/tool/util");return b.prototype={type:g.CHART_TYPE_VENN,_buildShape:function(){this.selectedMap={},this._symbol=this.option.symbolList,this._queryTarget,this._dropBoxList=[],this._vennDataCounter=0;for(var a=this.series,b=this.component.legend,c=0;c<a.length;c++)if(a[c].type===g.CHART_TYPE_VENN){a[c]=this.reformOption(a[c]);var d=a[c].name||"";if(this.selectedMap[d]=!b||b.isSelected(d),!this.selectedMap[d])continue;this._buildVenn(c)}this.addShapeList()},_buildVenn:function(a){var b,c,d=this.series[a],e=d.data;e[0].value>e[1].value?(b=this.zr.getHeight()/3,c=b*Math.sqrt(e[1].value)/Math.sqrt(e[0].value)):(c=this.zr.getHeight()/3,b=c*Math.sqrt(e[0].value)/Math.sqrt(e[1].value));var f=this.zr.getWidth()/2-b,g=(b+c)/2*Math.sqrt(e[2].value)/Math.sqrt((e[0].value+e[1].value)/2),h=b+c;0!==e[2].value&&(h=this._getCoincideLength(e[0].value,e[1].value,e[2].value,b,c,g,Math.abs(b-c),b+c));var i=f+h,j=this.zr.getHeight()/2;if(this._buildItem(a,0,e[0],f,j,b),this._buildItem(a,1,e[1],i,j,c),0!==e[2].value&&e[2].value!==e[0].value&&e[2].value!==e[1].value){var k=(b*b-c*c)/(2*h)+h/2,l=h/2-(b*b-c*c)/(2*h),m=Math.sqrt(b*b-k*k),n=0,o=0;e[0].value>e[1].value&&i<f+k&&(o=1),e[0].value<e[1].value&&i<f+l&&(n=1),this._buildCoincideItem(a,2,e[2],f+k,j-m,j+m,b,c,n,o)}},_getCoincideLength:function(a,b,c,d,e,f,g,h){var i=(d*d-e*e)/(2*f)+f/2,j=f/2-(d*d-e*e)/(2*f),k=Math.acos(i/d),l=Math.acos(j/e),m=d*d*Math.PI,n=k*d*d-i*d*Math.sin(k)+l*e*e-j*e*Math.sin(l),o=n/m,p=c/a,q=Math.abs(o/p);return q>.999&&q<1.001?f:q<=.999?(h=f,f=(f+g)/2,this._getCoincideLength(a,b,c,d,e,f,g,h)):(g=f,f=(f+h)/2,this._getCoincideLength(a,b,c,d,e,f,g,h))},_buildItem:function(a,b,c,d,e,f){var g=this.series,i=g[a],j=this.getCircle(a,b,c,d,e,f);if(h.pack(j,i,a,c,b,c.name),this.shapeList.push(j),i.itemStyle.normal.label.show){var k=this.getLabel(a,b,c,d,e,f);h.pack(k,i,a,i.data[b],b,i.data[b].name),this.shapeList.push(k)}},_buildCoincideItem:function(a,b,c,d,e,g,i,j,k,l){var m=this.series,n=m[a],o=[c,n],p=this.deepMerge(o,"itemStyle.normal")||{},q=this.deepMerge(o,"itemStyle.emphasis")||{},r=p.color||this.zr.getColor(b),s=q.color||this.zr.getColor(b),t="M"+d+","+e+"A"+i+","+i+",0,"+k+",1,"+d+","+g+"A"+j+","+j+",0,"+l+",1,"+d+","+e,u={color:r,path:t},v={zlevel:n.zlevel,z:n.z,style:u,highlightStyle:{color:s,lineWidth:q.borderWidth,strokeColor:q.borderColor}};v=new f(v),v.buildPathArray&&(v.style.pathArray=v.buildPathArray(u.path)),h.pack(v,m[a],0,c,b,c.name),this.shapeList.push(v)},getCircle:function(a,b,c,d,f,g){var h=this.series[a],i=[c,h],j=this.deepMerge(i,"itemStyle.normal")||{},k=this.deepMerge(i,"itemStyle.emphasis")||{},l=j.color||this.zr.getColor(b),m=k.color||this.zr.getColor(b),n={zlevel:h.zlevel,z:h.z,clickable:!0,style:{x:d,y:f,r:g,brushType:"fill",opacity:1,color:l},highlightStyle:{color:m,lineWidth:k.borderWidth,strokeColor:k.borderColor}};return this.deepQuery([c,h,this.option],"calculable")&&(this.setCalculable(n),n.draggable=!0),new e(n)},getLabel:function(a,b,c,e,f,g){var h=this.series[a],i=h.itemStyle,j=[c,h],k=this.deepMerge(j,"itemStyle.normal")||{},l="normal",m=i[l].label,n=m.textStyle||{},o=this.getLabelText(b,c,l),p=this.getFont(n),q=k.color||this.zr.getColor(b),r=n.fontSize||12,s={zlevel:h.zlevel,z:h.z,style:{x:e,y:f-g-r,color:n.color||q,text:o,textFont:p,textAlign:"center"}};return new d(s)},getLabelText:function(a,b,c){var d=this.series,e=d[0],f=this.deepQuery([b,e],"itemStyle."+c+".label.formatter");return f?"function"==typeof f?f(e.name,b.name,b.value):"string"==typeof f?(f=f.replace("{a}","{a0}").replace("{b}","{b0}").replace("{c}","{c0}"),f=f.replace("{a0}",e.name).replace("{b0}",b.name).replace("{c0}",b.value)):void 0:b.name},refresh:function(a){a&&(this.option=a,this.series=a.series),this._buildShape()}},i.inherits(b,c),a("../chart").define("venn",b),b});